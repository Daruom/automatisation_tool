---
- hosts: server1
  become: true
  become_user: true
  vars:
    password: Test123
    userid: userid_var
    sgrp: sgrp_var
    comments: comments_var
    username: username_var
    pgrp: pgrp_var
    hme: hme_var
  tasks:

    - name: Check user exist
      shell: id {{ username }}
      register: user_exist
      ignore_errors: yes

    - debug: msg="User name {{ username }} is already existing on {{ ansible_hostname }}"
      when: user_exist.rc == 0

    - name: User creation
      user:
        name: {{ username }}
        uid: {{ userid }}
        home: {{ hme }}
        comment: {{ comments }}
        password: {{ password }}
        group: {{ pgrp }}
        groups: {{ sgrp}}
        append: yes
      when: user_exist.rc != 0
      register: user_creation

    - debug: msg="User name {{ username }} has been created on {{ ansible_hostname }}"
      when: user_creation.changed
